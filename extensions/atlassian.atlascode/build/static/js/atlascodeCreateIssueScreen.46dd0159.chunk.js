"use strict";(self.webpackChunkatlascode=self.webpackChunkatlascode||[]).push([[464],{25840:(e,t,s)=>{s.r(t),s.d(t,{default:()=>CreateIssuePage});var a=s(22407),i=s(84005),n=s(32456),l=s(96540),r=s(97329),d=s(86732);const o=function FormHeader(e){var t=e.children,s=e.description,a=e.title;return l.createElement("div",null,a&&l.createElement(d.A,{size:"large"},a),s&&l.createElement("div",{className:(0,r.A)(["_1pfhu2gc"])},s),t&&l.createElement("div",{className:(0,r.A)(["_1ul91osq _1pfhu2gc"])},t))};var c=s(43305),h=s(71778),m=s(6994),u=s(46569),p=s(15560),g=s(70246),f=s(57617),E=s(67459),y=s(55677),v=s(64933),k=s(6406),F=s(31074),M=s(96611),S=s(22576),V=s(70376),b=s(14596),P=s(59927),C=s(63489),A=s(97503),I=s(79841);const x=l.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation"},l.createElement("path",{d:"M10.294 9.698a.988.988 0 010-1.407 1.01 1.01 0 011.419 0l2.965 2.94a1.09 1.09 0 010 1.548l-2.955 2.93a1.01 1.01 0 01-1.42 0 .988.988 0 010-1.407l2.318-2.297-2.327-2.307z",fill:"currentColor","fill-rule":"evenodd"})),O=l.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",role:"presentation"},l.createElement("path",{d:"M8.292 10.293a1.009 1.009 0 000 1.419l2.939 2.965c.218.215.5.322.779.322s.556-.107.769-.322l2.93-2.955a1.01 1.01 0 000-1.419.987.987 0 00-1.406 0l-2.298 2.317-2.307-2.327a.99.99 0 00-1.406 0z",fill:"currentColor","fill-rule":"evenodd"})),Panel=({isDefaultExpanded:e,header:t,children:s})=>{const[a,i]=(0,l.useState)(e);return l.createElement("div",{style:{marginTop:"16px",marginBottom:"36px"}},l.createElement("div",{onClick:()=>{i(!a)},style:{display:"flex",position:"relative",left:"-24px",alignItems:"center",padding:"2px 0 2px 24px",width:"100%",cursor:"pointer"}},l.createElement("span",{style:{position:"absolute",top:0,left:0}},a?O:x),l.createElement("span",null,t)),a&&s)},w={...I.b,...F.tm,isCreateBannerOpen:!1,createdIssue:{key:"",siteDetails:k.Rc}},IconOption=e=>l.createElement(g.c.Option,{...e},l.createElement("div",{ref:e.innerRef,...e.innerProps,style:{display:"flex",alignItems:"center"}},l.createElement("img",{src:e.data.avatarUrl,width:"24",height:"24",alt:e.data.name||"Avatar"}),l.createElement("span",{style:{marginLeft:"10px"}},e.data.name))),IconValue=e=>l.createElement(g.c.SingleValue,{...e},l.createElement("div",{style:{display:"flex",alignItems:"center"}},l.createElement("img",{src:e.data.avatarUrl,width:"16",height:"16",alt:e.data.name||"Avatar"}),l.createElement("span",{style:{marginLeft:"10px"}},e.data.name)));class CreateIssuePage extends I.i{getProjectKey(){return this.state.fieldValues.project.key}constructor(e){super(e),this.advancedFields=[],this.commonFields=[],this.attachingInProgress=!1,this.handleSubmit=async e=>{const t=Object.values(this.state.fields).filter((e=>e.required)),s={};if(t.forEach((e=>{if(e.uiType===y.HC.Worklog&&this.state.fieldValues[`${e.key}.enabled`]){const t=this.state.fieldValues[`${e.key}.timeSpent`],a=this.state.fieldValues[`${e.key}.newEstimate`],i=this.state.fieldValues[`${e.key}.started`],n=this.state.fieldValues[`${e.key}.comment`];(void 0===t||t.length<1)&&(s[`${e.key}.timeSpent`]="EMPTY"),(void 0===a||a.length<1)&&(s[`${e.key}.newEstimate`]="EMPTY"),(void 0===i||i.length<1)&&(s[`${e.key}.started`]="EMPTY"),(void 0===n||n.length<1)&&(s[`${e.key}.comment`]="EMPTY")}const t=this.state.fieldValues[e.key];(void 0===t||t.length<1)&&(s[e.key]="EMPTY")})),Object.keys(s).length>0)return s;this.setState({isSomethingLoading:!0,loadingField:"submitButton",isCreateBannerOpen:!1}),this.postMessage({action:"createIssue",site:this.state.siteDetails,issueData:this.state.fieldValues})},this.handleSiteChange=e=>{this.setState({siteDetails:e,loadingField:"site",isSomethingLoading:!0}),this.postMessage({action:"getScreensForSite",site:e})},this.handleInlineAttachments=async(e,t)=>{this.attachingInProgress||Array.isArray(t)&&t.length>0&&(this.attachingInProgress=!0,(0,S.f)(t).then((t=>{const s=t.map((e=>({lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,path:e.path,fileContent:e.fileContent})));this.setState({fieldValues:{...this.state.fieldValues,[e]:s}})})).finally((()=>this.attachingInProgress=!1)))},this.handleInlineEdit=async(e,t)=>{let s=t,a=e.key;if(void 0!==s)if(e.valueType===y.eV.Number&&"number"!==typeof t&&(s=parseFloat(t),isNaN(s)))this.setState({fieldValues:{...this.state.fieldValues,[a]:void 0}});else{if(e.key.indexOf(".")>-1){let t={};const i=e.key.split(".");a=i[0],this.state.fieldValues[i[0]]&&(t=this.state.fieldValues[i[0]]),t[i[1]]=s,s=t}e.uiType!==y.HC.Attachment?(this.setState({fieldValues:{...this.state.fieldValues,[a]:s}}),e.valueType===y.eV.Project&&(this.setState({loadingField:e.key,isSomethingLoading:!0}),this.postMessage({action:"getScreensForProject",project:t,fieldValues:this.state.fieldValues})),e.valueType===y.eV.IssueType&&(this.setState({loadingField:e.key,isSomethingLoading:!0}),this.postMessage({action:"setIssueType",issueType:t,fieldValues:this.state.fieldValues}))):await this.handleInlineAttachments(a,t)}else this.setState({fieldValues:{...this.state.fieldValues,[a]:s}})},this.fetchUsers=e=>this.loadSelectOptions(e,`${this.state.siteDetails.baseApiUrl}/api/${this.state.apiVersion}/user/search?${this.state.siteDetails.isCloud?"query":"username"}=`),this.formHeader=()=>l.createElement("div",null,"Create work item",this.state.isSomethingLoading&&l.createElement("div",{className:"spinner",style:{marginLeft:"15px"}},l.createElement(E.A,{size:"medium"}))),this.state=w}onMessageReceived(e){let t=super.onMessageReceived(e);if(!t)switch(e.type){case"update":{t=!0;const s=e;this.updateInternals(s),this.setState(s,(()=>{this.setState({isSomethingLoading:!1,loadingField:""})}));break}case"currentUserUpdate":t=!0,this.setState({currentUser:e.currentUser});break;case"issueCreated":t=!0,(0,F.QX)(e)&&this.setState({isErrorBannerOpen:!1,errorDetails:void 0,isSomethingLoading:!1,loadingField:"",isCreateBannerOpen:!0,createdIssue:e.issueData,fieldValues:{...this.state.fieldValues,description:"",summary:""}})}return t}updateInternals(e){const t=this.sortFieldValues(e.fields);this.advancedFields=[],this.commonFields=[],t.forEach((e=>{e.advanced&&"assignee"!==e.key?this.advancedFields.push(e):this.commonFields.push(e)}))}getCommonFieldMarkup(){return this.commonFields.map((e=>this.getInputMarkup(e)))}getAdvancedFieldMarkup(){return this.advancedFields.filter((e=>"parent"!==e.key)).map((e=>this.getInputMarkup(e)))}render(){var e;return(null===(e=this.state.fieldValues.issuetype)||void 0===e?void 0:e.id)||this.state.isErrorBannerOpen||!this.state.isOnline?l.createElement(u.Ay,null,l.createElement(M.H,{postMessageFunc:e=>{this.postMessage(e)},context:{view:v.id.CreateJiraIssuePage}},l.createElement("div",{style:{display:"flex",maxWidth:"1200px",margin:"20px auto 36px auto",justifyContent:"center"}},l.createElement("div",{style:{width:"60%"}},l.createElement("div",{style:{width:"100%"}},!this.state.isOnline&&l.createElement(C.A,null),this.state.showPMF&&l.createElement(A.A,{onPMFOpen:()=>this.onPMFOpen(),onPMFVisiblity:e=>this.setState({showPMF:e}),onPMFLater:()=>this.onPMFLater(),onPMFNever:()=>this.onPMFNever(),onPMFSubmit:e=>this.onPMFSubmit(e)}),this.state.isCreateBannerOpen&&l.createElement("div",{className:"fade-in"},l.createElement(p.A,{appearance:"success",title:"Issue Created"},l.createElement("p",null,"Issue"," ",l.createElement(a.A,{className:"ac-banner-link-button",appearance:"link",spacing:"none",onClick:()=>{this.handleOpenIssue(this.state.createdIssue)}},this.state.createdIssue.key)," ","has been created."))),this.state.isErrorBannerOpen&&l.createElement(b.A,{onDismissError:this.handleDismissError,errorDetails:this.state.errorDetails}),l.createElement(n.Ay,{name:"create-issue",onSubmit:this.handleSubmit},(e=>l.createElement("form",{...e.formProps},l.createElement(o,{title:this.formHeader()},l.createElement("p",null,"Required fields are marked with an asterisk ",l.createElement(c.A,null))),l.createElement(h.A,{label:l.createElement("span",null,"Site"),id:"site",name:"site",isRequired:!0,defaultValue:this.state.siteDetails},(e=>l.createElement(f.A,{...e.fieldProps,className:"ac-form-select-container",classNamePrefix:"ac-form-select",getOptionLabel:e=>e.name,getOptionValue:e=>e.id,options:this.state.selectFieldOptions.site,components:{Option:IconOption,SingleValue:IconValue},onChange:(0,P.cy)(e.fieldProps.onChange,this.handleSiteChange)}))),this.commonFields&&this.commonFields.length>0&&l.createElement("div",null,this.getCommonFieldMarkup()),this.advancedFields&&this.advancedFields.length>0&&l.createElement(Panel,{isDefaultExpanded:!1,header:l.createElement("h4",null,"Advanced Options")},l.createElement("div",null,this.getAdvancedFieldMarkup())),l.createElement(m.A,{actions:{}},l.createElement(i.A,{type:"submit",spacing:"compact",className:"ac-button",isDisabled:this.state.isSomethingLoading,isLoading:"submitButton"===this.state.loadingField},"Create"))))),this.state.transformerProblems&&Object.keys(this.state.transformerProblems).length>0&&l.createElement("div",{className:"fade-in",style:{marginTop:"20px"}},l.createElement("span",null,"non-renderable fields detected.")," ",l.createElement(a.A,{className:"ac-banner-link-button",appearance:"link",spacing:"none",onClick:()=>{this.postMessage({action:"openProblemReport"})}},"View a problem report"))))))):(this.postMessage({action:"refresh"}),l.createElement(V.V,null))}}}}]);