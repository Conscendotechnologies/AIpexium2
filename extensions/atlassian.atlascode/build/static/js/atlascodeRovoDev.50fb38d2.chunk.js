"use strict";(self.webpackChunkatlascode=self.webpackChunkatlascode||[]).push([[712],{27184:(e,t,o)=>{o.d(t,{G:()=>useMessagingApi});var n,a=o(96540);!function(e){e.Error="error",e.PMFStatus="pmfStatus",e.UpdateFeatureFlags="updateFeatureFlags",e.UpdateExperimentValues="updateExperimentValues"}(n||(n={}));var r=o(94211),s=o(59478);function useMessagingApi(e){const t=(0,a.useMemo)(acquireVsCodeApi,[acquireVsCodeApi]),o=(0,a.useCallback)((e=>{t.postMessage(e)}),[t]),l=(0,a.useCallback)(((e,o,a,r)=>(t.postMessage(e),new Promise(((e,t)=>{const s=setTimeout((()=>{window.removeEventListener("message",promiseListener),clearTimeout(s),t(`timeout waiting for event ${o}`)}),a),promiseListener=a=>{!a.data.type||!o||a.data.type!==o||r&&a.data.nonce!==r||(clearTimeout(s),window.removeEventListener("message",promiseListener),e(a.data)),a.data.type===n.Error&&r&&a.data.nonce===r&&(window.removeEventListener("message",promiseListener),clearTimeout(s),t(a.data.reason))};window.addEventListener("message",promiseListener)})))),[t]),i=(0,a.useContext)(r.Er),c=(0,a.useContext)(s.j8),d=(0,a.useCallback)((t=>{const o=t.data;if(o&&o.type)switch(o.type){case n.Error:i.showError(o.reason);break;case n.PMFStatus:o.showPMF&&c.showPMFBanner();break;default:e(o)}}),[i,c,e]);return(0,a.useEffect)((()=>(window.addEventListener("message",d),t.postMessage({type:"refresh"}),()=>{window.removeEventListener("message",d)})),[e,d,t]),[o,l]}},51252:(e,t,o)=>{o.r(t),o.d(t,{default:()=>rovoDevView});var n,a=o(84005),r=o(67525),s=o(28107),l=o(52249),i=o(43174),c=o(96540);!function(e){e.PromptSent="promptSent",e.Response="response",e.UserChatMessage="userChatMessage",e.CompleteMessage="completeMessage",e.ToolCall="toolCall",e.ToolReturn="toolReturn",e.ErrorMessage="errorMessage",e.NewSession="newSession",e.Initialized="initialized",e.CancelFailed="cancelFailed",e.CreatePRComplete="createPRComplete"}(n||(n={}));var d=o(27184),p=o(22407),u=o(65491),m=o(65251),g=o(16239);const v={display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",backgroundColor:"var(--vscode-editor-background)",fontSize:"var(--vscode-font-size)",fontFamily:"var(--vscode-font-family)",height:"100vh",margin:"0 -20px",maxWidth:"800px"},f={width:"100%",borderTop:"1px solid var(--vscode-panel-border)",background:"var(--vscode-sideBar-background)",padding:"16px",borderRadius:"12px 12px 0px 0px"},b={display:"flex",width:"100%"},x={width:"100%",background:"inherit",color:"var(--vscode-input-foreground)",resize:"none",outline:"none",border:"none",display:"flex",flexDirection:"column"},k={marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},h={width:"100%",border:"1px solid var(--vscode-input-border)",borderRadius:"2px",background:"var(--vscode-input-background)",padding:"8px"},y={width:"100%",overflowY:"auto",display:"flex",flexDirection:"column",flexGrow:"1",padding:"10px 16px 0 16px"},E={maxWidth:"100%",marginBottom:"8px",padding:"8px 12px",borderRadius:"8px",position:"relative"},C={width:"100%",margin:"4px 0",borderRadius:"8px",position:"relative"},w={backgroundColor:"var(--vscode-editor-selectionBackground)",alignSelf:"flex-end",borderBottomRightRadius:"0px"},R={backgroundColor:"var(--vscode-sideBar-background)",alignSelf:"flex-start",borderBottomLeftRadius:"0px"},_={border:"1px dashed var(--vscode-activityBarBadge-background)"},F={whiteSpace:"normal",wordBreak:"break-word",color:"var(--vscode-editor-foreground)"},P={display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:"0 8px",width:"100%",backgroundColor:"inherit",borderRadius:"4px",border:"1px solid var(--vscode-editorGroup-border)",color:"var(--vscode-input-placeholderForeground)",maxLines:1,overflow:"ellipsis",lineHeight:"1.5em"},S={cursor:"pointer",padding:"2px 6px",borderRadius:"2px"},M={padding:"2px 4px !important",backgroundColor:"var(--vscode-list-hoverBackground)"};function utils_parseToolReturnMessage(e){var t;const o=[],n=e;switch(n.tool_name){case"expand_code_chunks":case"find_and_replace_code":case"open_files":case"create_file":case"delete_file":const a=n.content.split("\n\n");for(const e of a){const n=e.match(/^Successfully\s+(expanded code chunks|replaced code|opened|created|deleted)(?:\s+in)?\s+(.+)?$/);if(n&&n.length>=3){let e=n[2].trim();(e.endsWith(":")||e.endsWith("."))&&(e=e.slice(0,-1));const a=e?null===(t=e.match(/([^/\\]+)$/))||void 0===t?void 0:t[0]:void 0;o.push({content:n[1].trim().toUpperCase(),filePath:e,title:a})}}0===o.length&&o.push({content:n.content});break;case"bash":const r=n.args&&JSON.parse(n.args);let s="";r&&r.command?s=r.command:console.warn("Bash command not found in args:",n.args),o.push({title:s,content:"EXECUTED"});break;case"create_technical_plan":o.push({content:"A cool technical plan",technicalPlan:n.content});break;default:o.push({content:e.content})}return o}g.Dz.setOptions({sanitize:!1,breaks:!0,smartLists:!0,gfm:!0});const ToolCallItem=({msg:e})=>e.tool_name&&e.args?c.createElement("div",{key:"tool-call",style:E},c.createElement("div",{style:P},c.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},c.createElement("i",{className:"codicon codicon-loading codicon-modifier-spin"}),e.tool_name))):c.createElement("div",{key:"invalid-tool-call"},"Error: Invalid tool call message"),ToolReturnParsedItem=({msg:e,openFile:t})=>{const[o,n]=c.useState(!1);return c.createElement("div",{style:C,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},c.createElement("a",{onClick:()=>e.filePath&&t(e.filePath),style:e.filePath&&o?{...P,cursor:"pointer",backgroundColor:"var(--vscode-list-hoverBackground)"}:P},c.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},e.title&&c.createElement("div",{style:{fontWeight:"bold"}},e.title)),c.createElement("div",{style:{fontSize:"9px",textAlign:"right"}},e.content)))},ChatMessageItem=({msg:e,index:t,openFile:o})=>{const n="user"===e.author.toLowerCase()?w:R,a=(e.text||"").trim().split(/(<TOOL_RETURN>.*<\/TOOL_RETURN>)/g).flatMap((e=>{try{if(e.match(/^<TOOL_RETURN>.*<\/TOOL_RETURN>$/)){const t=e.replace(/^<TOOL_RETURN>/,"").replace(/<\/TOOL_RETURN>$/,"").trim(),n=JSON.parse(t);console.log("Parsed Tool Return Message:",n);return utils_parseToolReturnMessage(n).map(((e,t)=>c.createElement(ToolReturnParsedItem,{key:t,msg:e,openFile:o})))}{const t=g.Dz.parse(e);return c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},key:"parsed-content",dangerouslySetInnerHTML:{__html:t}})}}catch(e){return console.error("Error parsing message content:",e),c.createElement("div",{key:"error-content"},"Error parsing content")}}));return c.createElement("div",{key:t,style:{...E,...n}},c.createElement("div",{style:F},a))},UpdatedFilesComponent=({modifiedFiles:e,onUndo:t,onAccept:o,openDiff:a,onCreatePR:r})=>{const[s,l]=c.useState(!1),[i,d]=c.useState(!1),[p,u]=c.useState(!1);window.addEventListener("message",(e=>{e.data.type===n.CreatePRComplete&&u(!1)}));const m=(0,c.useCallback)((()=>{const t=e.map((e=>e.filePath)).filter((e=>void 0!==e));o(t)}),[o,e]),g=(0,c.useCallback)((()=>{const o=e.map((e=>e.filePath)).filter((e=>void 0!==e));t(o)}),[t,e]);return e&&0!==e.length?c.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",background:"var(--vscode-sideBar-background)",paddingBottom:"4px"}},c.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"10px",padding:" 0 8px",alignItems:"center"}},c.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"4px"}},c.createElement("i",{className:"codicon codicon-source-control"}),c.createElement("span",{style:{fontWeight:"bold"}},e.length," Updated file(s)")),c.createElement("div",{style:{display:"flex",flexDirection:"row",gap:"4px"}},c.createElement("button",{style:{color:"var(--vscode-button-secondaryForeground)",backgroundColor:s?"var(--vscode-button-secondaryHoverBackground)":"var(--vscode-button-secondaryBackground)",border:"1px solid var(--vscode-button-secondaryBorder)",...S},onClick:()=>g(),onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)},"Undo"),c.createElement("button",{style:{color:"var(--vscode-button-foreground)",backgroundColor:i?"var(--vscode-button-hoverBackground)":"var(--vscode-button-background)",border:"1px solid var(--vscode-button-border)",...S},onClick:()=>m(),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)},"Keep"),c.createElement("button",{style:{color:"var(--vscode-button-secondaryForeground)",backgroundColor:"var(--vscode-button-background)",border:"1px solid var(--vscode-button-secondaryBorder)",...S},onClick:()=>{u(!0),r()},title:"Create Pull Request"},p?c.createElement("i",{className:"codicon codicon-loading codicon-modifier-spin"}):c.createElement("i",{className:"codicon codicon-git-pull-request-create"})))),c.createElement("div",{style:{width:"100%",height:"100%",display:"block",overflowY:"auto",maxHeight:"100px",padding:"4px 8px",borderTop:"1px solid var(--vscode-panel-border)"}},e.map(((e,n)=>c.createElement(ModifiedFileItem,{key:n,msg:e,onFileClick:e=>a(e,!0),onUndo:e=>t([e]),onAccept:e=>o([e])}))))):null},ModifiedFileItem=({msg:e,onUndo:t,onAccept:o,onFileClick:n})=>{const[a,r]=c.useState(!1),[s,l]=c.useState(!1),[i,d]=c.useState(!1),g=e.filePath;if(!g)return null;return c.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:a?"var(--vscode-list-hoverBackground)":"inherit",cursor:"pointer",padding:"2px 8px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:"100%"},onClick:()=>n(g),onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)},c.createElement("div",null,g),c.createElement("div",{style:{display:a?"flex":"none",alignItems:"center",flexDirection:"row",gap:"4px"}},c.createElement(p.A,{spacing:"none",style:{...M,color:s?"var(--vscode-textLink-foreground) !important":"var(--vscode-textForeground) !important"},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),iconBefore:c.createElement(m.A,{size:"small",label:"Close"}),onClick:e=>{e.stopPropagation(),t(g)}}),c.createElement(p.A,{style:{...M,color:i?"var(--vscode-textLink-foreground) !important":"var(--vscode-textForeground) !important"},onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),spacing:"none",iconBefore:c.createElement(u.A,{size:"small",label:"Keep"}),onClick:e=>{e.stopPropagation(),o(g)}})))};var T,L;!function(e){e.Prompt="prompt",e.CancelResponse="cancelResponse",e.OpenFile="openFile",e.UndoFiles="undoFiles",e.AcceptFiles="acceptFiles",e.CreatePR="createPR"}(T||(T={})),function(e){e[e.WaitingForPrompt=0]="WaitingForPrompt",e[e.GeneratingResponse=1]="GeneratingResponse",e[e.CancellingResponse=2]="CancellingResponse"}(L||(L={}));const B={[L.WaitingForPrompt]:"Type in a question",[L.GeneratingResponse]:"Generating response...",[L.CancellingResponse]:"Cancelling the response..."},rovoDevView=()=>{const[e,t]=(0,c.useState)(!1),[o,p]=(0,c.useState)(L.WaitingForPrompt),[u,m]=(0,c.useState)(!1),[g,E]=(0,c.useState)(""),[C,w]=(0,c.useState)(""),[F,P]=(0,c.useState)([]),[S,M]=(0,c.useState)(null),[U,D]=(0,c.useState)([]),O=c.useRef(null);c.useEffect((()=>{O.current&&O.current.scrollIntoView({behavior:"smooth"});document.querySelectorAll("pre code").forEach((e=>{(0,l.li)(e,(0,i.o)(e.textContent||""))}))}),[F,C]);const A=(0,c.useCallback)((e=>{e&&w((t=>t&&t.trim()&&"..."!==t?t+e:e))}),[w]),N=(0,c.useCallback)((e=>{P((t=>[...t,e]))}),[P]),z=(0,c.useCallback)((e=>{if(t=e.tool_name,["find_and_replace_code","create_file","delete_file"].includes(t)){const t=utils_parseToolReturnMessage(e).filter((e=>e.filePath));D((e=>Array.from(new Map([...e,...t].map((e=>[e.filePath,e]))).values())))}var t}),[D]),W=(0,c.useCallback)((e=>{D((t=>t.filter((t=>!e.includes(t.filePath)))))}),[D]),I=(0,c.useCallback)((e=>{switch(console.log("Received response data:",e),e.event_kind){case"text":if(!e.content)break;A(e.content);break;case"tool-call":const t={author:"ToolCall",tool_name:e.tool_name,args:e.args,tool_call_id:e.tool_call_id};M(t);break;case"tool-return":const o=e.tool_call_id===(null===S||void 0===S?void 0:S.tool_call_id)?null===S||void 0===S?void 0:S.args:void 0,n={author:"ToolReturn",tool_name:e.tool_name,content:e.content||"",tool_call_id:e.tool_call_id,args:o};M(null),A(`\n\n<TOOL_RETURN>${JSON.stringify(n)}</TOOL_RETURN>\n\n`),z(n);break;default:A(`\n\nUnknown part_kind: ${e.event_kind}\n\n`)}}),[A,z,S]),G=(0,c.useCallback)((e=>{if(e||C&&"..."!==C){N({text:"..."===C?"Error: Unable to retrieve the response":C,author:"RovoDev"})}w("")}),[C,N,w]),j=(0,c.useCallback)((e=>{switch(e.type){case n.PromptSent:t(!0),p(L.GeneratingResponse),w("...");break;case n.Response:I(e.dataObject);break;case n.UserChatMessage:G(),N(e.message);break;case n.CompleteMessage:G(!0),t(!1),p(L.WaitingForPrompt),M(null);break;case n.ToolCall:case n.ToolReturn:I(e.dataObject);break;case n.ErrorMessage:G(),N(e.message),w(""),t(!1),p(L.WaitingForPrompt),M(null);break;case n.NewSession:P([]),M(null);break;case n.Initialized:t(!1);break;case n.CancelFailed:o===L.CancellingResponse&&p(L.GeneratingResponse);break;default:console.warn("Unknown message type:",e.type)}}),[I,G,N,o,p]),[$]=(0,d.G)(j),q=(0,c.useCallback)((n=>{e||""===n.trim()||o!==L.WaitingForPrompt||(w("..."),t(!0),p(L.GeneratingResponse),$({type:T.Prompt,text:n}),E(""))}),[$,w,e,t,o,p]),V=(0,c.useCallback)((()=>{o!==L.CancellingResponse&&(p(L.CancellingResponse),$({type:T.CancelResponse}))}),[$,o,p]),H=(0,c.useCallback)(((e,t,o)=>{$({type:T.OpenFile,filePath:e,tryShowDiff:!!t,range:o&&2===o.length?o:void 0})}),[$]),K=(0,c.useCallback)((e=>{$({type:T.UndoFiles,filePaths:e}),W(e)}),[$,W]),J=(0,c.useCallback)((e=>{$({type:T.AcceptFiles,filePaths:e}),W(e)}),[$,W]),Y=(0,c.useCallback)((e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),q(g))}),[q,g]);return c.createElement("div",{className:"rovoDevChat",style:v},c.createElement("div",{style:y},F.map(((e,t)=>((e,t,o)=>{switch(e.author){case"ToolReturn":return utils_parseToolReturnMessage(e).map((e=>c.createElement(ToolReturnParsedItem,{key:t,msg:e,openFile:o})));case"RovoDev":case"User":return c.createElement(ChatMessageItem,{index:t,msg:e,openFile:o});default:return c.createElement("div",{key:t},"Unknown message type")}})(e,t,H))),S&&c.createElement(ToolCallItem,{msg:S}),C&&c.createElement("div",{style:{...R,..._,borderRadius:"8px"}},c.createElement(ChatMessageItem,{msg:{text:C,author:"RovoDev"},openFile:H})),c.createElement("div",{ref:O})),c.createElement("div",{style:f},c.createElement(UpdatedFilesComponent,{modifiedFiles:U,onUndo:K,onAccept:J,openDiff:H,onCreatePR:()=>{$({type:T.CreatePR})}}),c.createElement("div",{style:b},c.createElement("div",{onFocus:()=>m(!0),onBlur:()=>m(!1),style:u?{...h,outline:"var(--vscode-focusBorder) solid 1px"}:h},c.createElement("textarea",{style:x,placeholder:B[o],onChange:e=>E(e.target.value),onKeyDown:Y,value:g}),c.createElement("div",{style:k},o===L.WaitingForPrompt&&c.createElement(a.A,{style:{color:"var(--vscode-input-foreground) !important",border:"1px solid var(--vscode-button-border) !important",backgroundColor:"var(--vscode-input-background) !important"},label:"Send button",iconBefore:c.createElement(r.A,{size:"small",label:"Send"}),isDisabled:e,onClick:()=>q(g)}),o!==L.WaitingForPrompt&&c.createElement(a.A,{style:{color:"var(--vscode-input-foreground) !important",border:"1px solid var(--vscode-button-border) !important",backgroundColor:"var(--vscode-input-background) !important"},label:"Stop button",iconBefore:c.createElement(s.A,{size:"small",label:"Stop"}),isDisabled:o===L.CancellingResponse,onClick:()=>V()}))))))}}}]);