"use strict";(self.webpackChunkatlascode=self.webpackChunkatlascode||[]).push([[245],{82522:(e,t,s)=>{s.d(t,{A:()=>NavItem});var a=s(22407),n=s(76234),i=s(15547),l=s(96540);class NavItem extends l.Component{render(){return l.createElement("div",{className:"ac-icon-with-text"},this.props.iconUrl&&l.createElement("img",{style:{paddingRight:"5px"},src:this.props.iconUrl}),l.createElement("div",{className:"jira-issue-key"},l.createElement(a.A,{className:"ac-link-button",appearance:"link",spacing:"none",href:this.props.href,onClick:this.props.onItemClick},this.props.text),this.props.onCopy&&l.createElement("div",{className:"jira-issue-copy-icon",onClick:this.props.onCopy},l.createElement(i.A,{content:"Copy the web link to clipboard"},l.createElement(n.A,{label:"copy issue link",size:"small"})))))}}},94766:(e,t,s)=>{s.r(t),s.d(t,{default:()=>JiraIssuePage});var a=s(46569),n=s(32935),i=s(93420),l=s(15547),r=s(26865),o=s(55677),c=s(18297),d=s(44414),m=s(41394),h=s(96540),u=s(25279),p=s(64933),g=s(31074),E=s(96611),v=s(22576),y=s(27030),k=s(70376),f=s(14596),b=s(63489),A=s(97503),C=s(79841),S=s(82522),x=s(22407),w=s(66278);class PullRequests extends h.Component{prState(e){switch(e.state){case"MERGED":return h.createElement(w.A,{appearance:"success"},"Merged");case"SUPERSEDED":return h.createElement(w.A,{appearance:"moved"},"Superseded");case"OPEN":return h.createElement(w.A,{appearance:"inprogress"},"Open");case"DECLINED":return h.createElement(w.A,{appearance:"removed"},"Declined");default:return h.createElement("div",null)}}render(){return this.props.pullRequests.map((e=>{const t=`${e.destination.repo.displayName} - Pull request #${e.id}`;return h.createElement(l.A,{content:`${e.author.displayName}: ${t}`},h.createElement("div",{key:e.url,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{maxLines:1,textOverflow:"ellipsis",overflow:"auto"}},h.createElement(x.A,{appearance:"link",onClick:()=>this.props.onClick(e)},t)),h.createElement("div",{style:{overflow:"visible"}},this.prState(e))))}))}}var I=s(85832),D=s(83723),N=s(3519),L=s(2337),V=s(25229),F=s(72692),M=s(71210),U=s(64834),P=s(86720);const CommentComponent=({siteDetails:e,comment:t,onSave:s,fetchImage:a,onDelete:n,fetchUsers:i,isServiceDeskProject:l,isRteEnabled:r=!1})=>{const[o,c]=h.useState(!1),[u,p]=h.useState(!1),g=t.renderedBody?t.renderedBody:t.body,[E,v]=h.useState(t.body),y=[h.createElement(D.A,{onClick:()=>{c(!0)}},"Edit")],k=t.author.accountId===e.userId?[...y,h.createElement(D.A,{onClick:()=>{n(t.id),p(!0),v("")}},"Delete")]:y;return h.createElement(N.A,{avatar:h.createElement(I.A,{src:t.author.avatarUrls["48x48"],size:"small",borderColor:"var(--vscode-editor-background)!important"}),author:h.createElement(L.A,null,h.createElement("div",{className:"jira-comment-author"},t.author.displayName)),isSaving:u,edited:t.created!==t.updated?h.createElement(V.A,null,"Edited"):null,content:h.createElement(h.Fragment,null,o&&!u?h.createElement(P.A,{value:E,onChange:e=>{v(e)},onSave:()=>{p(!0),c(!1),s(E,t.id,void 0)},onCancel:()=>{p(!1),c(!1),v(t.body)},fetchUsers:i,isServiceDeskProject:l,onInternalCommentSave:()=>{p(!1),c(!1),s(E,t.id,M.w9)},featureGateEnabled:r}):h.createElement(U.t,{html:g,fetchImage:a})),time:h.createElement("div",{className:"inlinePanelSubheading"},`${(0,d.m)((0,m.H)(t.created))} ago`),actions:k})},AddCommentComponent=({fetchUsers:e,user:t,onCreate:s,isServiceDeskProject:a,isRteEnabled:n=!1})=>{const[i,l]=h.useState(""),[r,o]=h.useState(!1);return h.createElement(c.A,{style:{display:"flex",flexDirection:"column",width:"100%"}},h.createElement(c.A,{style:{display:"flex",flexDirection:"row",alignItems:r?"start":"center"}},h.createElement(c.A,{style:{marginRight:"8px",marginTop:r?"4px":"0px"}},h.createElement(I.A,{src:t.avatarUrls["48x48"],size:"small",borderColor:"var(--vscode-editor-background)!important"})),r?h.createElement(P.A,{value:i,onChange:e=>l(e),onSave:e=>{""!==e&&(s(e,void 0),l(""),o(!1))},onCancel:()=>{l(""),o(!1)},onEditorFocus:()=>{o(!0)},fetchUsers:e,isServiceDeskProject:a,onInternalCommentSave:()=>{s(i,M.w9),l(""),o(!1)},featureGateEnabled:n}):h.createElement(F.A,{readOnly:!0,className:"ac-inputField",css:{":placeholder":{color:"var(--vscode-input-placeholderForeground) !important"}},onClick:()=>{o(!0)},placeholder:"Add a comment..."})))},IssueCommentComponent=({siteDetails:e,currentUser:t,comments:s,isServiceDeskProject:a,onCreate:n,onSave:i,fetchUsers:l,fetchImage:r,onDelete:o,isRteEnabled:d=!1})=>h.createElement(c.A,{style:{display:"flex",flexDirection:"column",paddingTop:"8px"}},h.createElement(AddCommentComponent,{fetchUsers:l,user:t,onCreate:n,isRteEnabled:d}),s.sort(((e,t)=>e.created>t.created?-1:1)).map((t=>h.createElement(CommentComponent,{key:`${t.id}::${t.updated}`,siteDetails:e,comment:t,onSave:i,fetchImage:r,onDelete:o,fetchUsers:l,isServiceDeskProject:a,isRteEnabled:d}))));var O=s(49188),R=s(16820),W=s(93297),B=s(90585),j=s(94969),z=s(22648),T=s(52196),$=s(19412),H=s(7135);const Delete=e=>h.createElement("div",{className:"ac-delete",onClick:()=>e.delfunc(e.attachment)},h.createElement(B.A,{label:"trash"})),ExternalLink=e=>h.createElement(l.A,{content:"View in browser"},h.createElement(x.A,{className:"ac-link-button",appearance:"link",iconBefore:h.createElement(W.A,{size:"small",label:"open-attachment"}),href:`${e.baseLinkUrl}/rest/api/2/attachment/content/${e.attachment.id}`})),Size=e=>{const t="number"===typeof e.attachment.size?e.attachment.size:parseFloat(e.attachment.size),s=(0,$.O)(t);return h.createElement("p",{style:{display:"inline"}},s)},AttachmentList=({baseLinkUrl:e,attachments:t,onDelete:s,fetchImage:a})=>{const[n,i]=(0,h.useState)(void 0);return h.createElement(h.Fragment,null,h.createElement(T.A,{columns:[e=>H.g.includes(e.attachment.mimeType)?h.createElement("a",{style:{display:"inline"},href:"#",onClick:()=>i(e.attachment)},e.attachment.filename):h.createElement("p",null,e.attachment.filename),ExternalLink,Size,Delete],columnWidths:["100%","50px","150px","50px"],items:t.map((t=>({id:t.id,content:{baseLinkUrl:e,attachment:t,delfunc:s}})))}),h.createElement(j.A,null,n&&h.createElement(z.A,{heading:n.filename,shouldCloseOnEscapePress:!0,width:"x-large",onClose:()=>i(void 0)},h.createElement(U.t,{html:`<img src=${n.content} />`,fetchImage:a}))))};var q=s(7903);const K=[],AttachmentsModal=({isOpen:e,onSave:t,onCancel:s})=>{const[a,n]=(0,h.useState)(K);return e?h.createElement(j.A,null,h.createElement(z.A,{onClose:s,heading:"Add Attachment",shouldCloseOnEscapePress:!1},h.createElement(H.S,{onFilesChanged:n}),h.createElement(q.A,null,h.createElement(x.A,{className:"ac-button",onClick:()=>{t(a)},isDisabled:a.length<1},"Save"),h.createElement(x.A,{className:"ac-button",onClick:s},"Cancel")))):h.createElement(h.Fragment,null)};var G=s(39056),J=s(44750),Y=s(32456),Q=s(71778),X=s(98164),_=s(52556),Z=s(6994),ee=s(9798),te=s(59927);const se={comment:"",started:"",timeSpent:"",newEstimate:"",autoAdjust:!0},ae="yyyy-MM-dd'T'HH:mm:ss.SSSXX";class WorklogForm extends h.Component{constructor(e){super(e),this.handleClose=()=>{this.setState({...se}),this.props.onCancel()},this.disableSaving=()=>""===this.state.started||""===this.state.timeSpent.trim()||!this.state.autoAdjust&&""===this.state.newEstimate.trim(),this.handleSave=e=>{const t={comment:e.comment,started:(0,ee.GP)(new Date(e.started),ae),timeSpent:e.timeSpent,adjustEstimate:e.newEstimate&&""!==e.newEstimate?"new":"auto",newEstimate:e.newEstimate};this.props.onSave&&this.props.onSave(t),this.handleClose()},this.state={...se,savingDisabled:!0,started:(0,ee.GP)(Date.now(),ae)}}render(){const e=""!==this.state.started.trim()?this.state.started:(0,ee.GP)(Date.now(),ae);return h.createElement("div",null,h.createElement(Y.Ay,{name:"worklog-form",onSubmit:this.handleSave},(t=>h.createElement("form",{...t.formProps},h.createElement(Q.A,{label:"Description",isRequired:!1,id:"comment",name:"comment",defaultValue:this.state.comment},(e=>h.createElement("textarea",{...e.fieldProps,style:{width:"100%",display:"block"},className:"ac-textarea",rows:3,onChange:te.cy(e.fieldProps.onChange,(e=>{this.setState({comment:e.target.value},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))}))),h.createElement(Q.A,{label:"Date",id:"started",name:"started",isRequired:!0,validate:te.oI,defaultValue:e},(t=>{let s=h.createElement("span",null);return"EMPTY"===t.error&&(s=h.createElement(X.Kw,null,"Date is required")),h.createElement("div",null,h.createElement(J.A,{defaultValue:e,timeIsEditable:!0,className:"ac-select-container",datePickerSelectProps:{className:"ac-select-container",classNamePrefix:"ac-select"},timePickerSelectProps:{className:"ac-select-container",classNamePrefix:"ac-select"},onChange:te.cy(t.fieldProps.onChange,(e=>{document.activeElement.blur(),this.setState({started:e},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))}),s)})),h.createElement(Q.A,{label:"Time spent",id:"timeSpent",name:"timeSpent",isRequired:!0,defaultValue:this.state.timeSpent,validate:te.oI},(e=>{let t=h.createElement("span",null);return"EMPTY"===e.error&&(t=h.createElement(X.Kw,null,"Time spent is required")),h.createElement("div",null,h.createElement("input",{...e.fieldProps,style:{width:"100%",display:"block"},className:"ac-inputField",onChange:te.cy(e.fieldProps.onChange,(e=>{this.setState({timeSpent:e.target.value},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))}),h.createElement(X.st,null,"(eg. 3w 4d 12h)"),t)})),h.createElement(_.A,{name:"autoAdjust",id:"autoAdjust",value:"autoAdjust",defaultIsChecked:this.state.autoAdjust},(e=>h.createElement(G.A,{...e.fieldProps,label:"Auto adjust remaining estimate",onChange:te.cy(e.fieldProps.onChange,(e=>{this.setState({autoAdjust:e.target.checked},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))}))),!this.state.autoAdjust&&h.createElement(Q.A,{label:"Remaining estimate",id:"newEstimate",name:"newEstimate",isRequired:!this.state.autoAdjust,defaultValue:this.state.newEstimate,validate:te.oI},(e=>{let t=h.createElement("span",null);return"EMPTY"===e.error&&(t=h.createElement(X.Kw,null,"Remaining estimate is required")),h.createElement("div",null,h.createElement("div",{className:"ac-flex"},h.createElement("input",{...e.fieldProps,disabled:this.state.autoAdjust,style:{width:"100%",display:"block"},className:"ac-inputField",onChange:te.cy(e.fieldProps.onChange,(e=>{this.setState({newEstimate:e.target.value},(()=>{this.setState({savingDisabled:this.disableSaving()})}))}))})),h.createElement(X.st,null,"(eg. 3w 4d 12h) original estimate ",this.props.originalEstimate),t)})),h.createElement(Z.A,{actions:{}},h.createElement("div",{style:{display:"inline-flex",marginRight:"4px",marginLeft:"4px;"}},h.createElement(x.A,{type:"submit",className:"ac-button",isDisabled:this.state.savingDisabled},"Submit")),h.createElement("div",{style:{display:"inline-flex",marginRight:"4px",marginLeft:"4px;"}},h.createElement(x.A,{className:"ac-button",onClick:this.handleClose},"Cancel"))),h.createElement("div",{style:{height:"20px"}})))))}}const Created=e=>h.createElement("p",{style:{display:"inline"}},`${(0,d.m)((0,m.H)(e.worklog.created))} ago`),Comment=e=>h.createElement("p",{style:{display:"inline"}},e.worklog.comment),TimeSpent=e=>h.createElement("p",{style:{display:"inline"}},e.worklog.timeSpent),Author=e=>{const t=e.worklog.author.avatarUrls&&e.worklog.author.avatarUrls["48x48"]?e.worklog.author.avatarUrls["48x48"]:"";return h.createElement("div",{className:"ac-flex"},h.createElement(I.A,{size:"small",borderColor:"var(--vscode-editor-background)!important",src:t}),h.createElement("p",{style:{marginLeft:"4px"}},e.worklog.author.displayName))};class Worklogs extends h.Component{constructor(e){super(e)}render(){return h.createElement(T.A,{columns:[Author,Comment,TimeSpent,Created],columnWidths:["100%","100%","150px","150px"],items:this.props.worklogs.worklogs.map((e=>({id:e.id,content:{worklog:e}})))})}}var ne=s(84005),ie=s(65508),le=s(54363),re=s(35394),oe=s(73960),ce=s(6034),de=s(41587);const AddContentDropdown=({handleAttachmentClick:e,handleChildIssueClick:t,handleLinkedIssueClick:s,handleLogWorkClick:a,loading:n})=>{const[i,l]=h.useState(!1),[r,o]=h.useState(!1);return h.createElement(c.A,{style:{display:"flex"}},h.createElement(ie.A,{css:{backgroundColor:"var(--vscode-settings-textInputBackground)!important",":hover":{backgroundColor:"var(--vscode-editor-selectionHighlightBackground)!important"}},onOpenChange:e=>l(e.isOpen),isLoading:n,trigger:({triggerRef:e,...t})=>h.createElement(ne.A,{isLoading:n,onMouseOver:()=>o(!0),onMouseLeave:()=>o(!1),style:{alignContent:"center",border:i||r?"1px solid var(--vscode-list-focusOutline)":"1px solid var(--vscode-editorGroup-border)",backgroundColor:"var(--vscode-editor-background)",color:"var(--vscode-editor-foreground)"},...t,ref:e,iconBefore:h.createElement(O.A,{size:"small",label:"Add"})},"Add")},h.createElement(c.A,{style:{display:"flex",flexDirection:"column",backgroundColor:"var(--vscode-settings-textInputBackground)",paddingTop:"4px",paddingBottom:"4px",border:"1px solid var(--vscode-list-focusOutline)"}},h.createElement(le.A,{css:me,elemBefore:h.createElement(oe.A,{label:"Add Attachment"}),onClick:e},"Attachment"),h.createElement(le.A,{css:me,elemBefore:h.createElement(re.A,{label:"Add Child Issues"}),onClick:t},"Child issue"),h.createElement(le.A,{css:me,elemBefore:h.createElement(de.A,{label:"Add Linked Issue"}),onClick:s},"Linked issue"),h.createElement(le.A,{css:me,elemBefore:h.createElement(ce.A,{label:"Log Work"}),onClick:a},"Work log"))))},me={background:"var(--vscode-settings-textInputBackground)!important",color:"var(--vscode-settings-textInputForeground)!important",":hover":{background:"var(--vscode-editor-selectionHighlightBackground) !important"}};var he=s(57617),ue=s(70246),pe=s(72007),ge=s(59972),Ee=s(79402);const IssueKey=e=>h.createElement("div",{className:"ac-flex-space-between"},h.createElement("div",{style:{width:"16px",height:"16px"}},h.createElement(l.A,{content:e.issue.issuetype.name},h.createElement("img",{src:e.issue.issuetype.iconUrl}))),h.createElement(x.A,{appearance:"subtle-link",onClick:()=>e.onIssueClick({siteDetails:e.issue.siteDetails,key:e.issue.key})},e.issue.key)),Summary=e=>h.createElement("p",{style:{display:"inline"}},e.issue.summary),Priority=e=>e.issue.priority&&e.issue.priority.name&&e.issue.priority.iconUrl?h.createElement("div",{style:{width:"16px",height:"16px"}},h.createElement(l.A,{content:e.issue.priority.name},h.createElement("img",{src:e.issue.priority.iconUrl}))):h.createElement(h.Fragment,null),StatusColumn=e=>{if(e.issue.status&&e.issue.status.statusCategory){const t=Ee.zK[e.issue.status.statusCategory.colorName];return h.createElement(w.A,{appearance:t},e.issue.status.name)}return h.createElement(h.Fragment,null)};class IssueList extends h.Component{constructor(e){super(e)}render(){return h.createElement(T.A,{columns:[IssueKey,Summary,Priority,StatusColumn],columnWidths:["150px","100%","20px","150px"],items:this.props.issues.map((e=>({id:e.key,content:{issue:e,onIssueClick:this.props.onIssueClick}})))})}}const{Option:ve,SingleValue:ye}=ue.c,IconOption=e=>h.createElement(ve,{...e},h.createElement("div",{ref:e.innerRef,...e.innerProps,className:"ac-flex"},h.createElement("img",{src:e.data.iconUrl,width:"24",height:"24",alt:e.data.name||"Issue type icon"}),h.createElement("span",{style:{marginLeft:"10px"}},e.label))),IconValue=e=>h.createElement(ye,{...e},h.createElement("div",{style:{display:"flex",alignItems:"center"}},h.createElement("img",{src:e.data.iconUrl,width:"16",height:"16",alt:e.data.name||"Issue type icon"}),h.createElement("span",{style:{marginLeft:"10px"}},e.data.name))),ChildIssuesComponent=({subtaskTypes:e,label:t,onSave:s,loading:a,enableSubtasks:n,handleOpenIssue:i,issues:l})=>{const[r,o]=h.useState(!1),[d,m]=h.useState(""),[u,p]=h.useState(e.length>0?e[0]:pe.hG),{enable:g,setEnableSubtasks:E}=n;h.useEffect((()=>{g&&o(!0)}),[g]);return h.createElement(c.A,null,h.createElement(c.A,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},h.createElement("div",{style:{display:"flex",gap:"8px",flexDirection:"row",alignItems:"flex-start"}},h.createElement("label",{className:"ac-field-label"},t),a?h.createElement("p",null,"Saving..."):null),h.createElement(x.A,{className:"ac-button-secondary",appearance:"subtle",iconBefore:h.createElement(O.A,{size:"small",label:"Add"}),onClick:()=>o(!0)})),r&&h.createElement(c.A,{style:{display:"flex",flexDirection:"column",gap:"8px"}},h.createElement(c.A,{style:{display:"flex",flexDirection:"row",gap:"8px",width:"100%"}},h.createElement("div",{style:{width:"30%"}},h.createElement(he.A,{className:"ac-select-container",classNamePrefix:"ac-select",options:e,defaultValue:u,components:{Option:IconOption,SingleValue:IconValue},getOptionLabel:e=>e.name,getOptionValue:e=>e.id,isDisabled:a,onChange:e=>{p(e)}})),h.createElement(F.A,{className:"ac-inputField",placeholder:"What needs to be done?",onChange:e=>m(e.currentTarget.value)})),h.createElement(c.A,{style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},h.createElement(ge.Ls,{appearance:"primary",disabled:""===d||a,onClick:()=>{if(""===d.trim())return;const e=u||pe.hG;s({summary:d,issuetype:{id:e.id}}),m(""),o(!1)}},"Create"),h.createElement(ge.Ls,{appearance:"secondary",onClick:()=>{m(""),o(!1),p(e.length>0?e[0]:pe.hG),E(!1)}},"Cancel"))),h.createElement(IssueList,{onIssueClick:i,issues:l}))};var ke=s(3672),fe=s(47292);const LinkedIssues_IssueKey=e=>{const t=e.issue.issuetype&&e.issue.issuetype.name&&e.issue.issuetype.iconUrl?h.createElement("div",{style:{width:"16px",height:"16px"}},h.createElement(l.A,{content:e.issue.issuetype.name},h.createElement("img",{src:e.issue.issuetype.iconUrl}))):h.createElement(h.Fragment,null);return h.createElement("div",{className:"ac-flex-space-between"},h.createElement("p",{style:{display:"inline"}},h.createElement("em",{style:{position:"absolute",bottom:"2.25em"}},e.linkDescription)),t,h.createElement(x.A,{appearance:"subtle-link",onClick:()=>e.onIssueClick({siteDetails:e.issue.siteDetails,key:e.issue.key})},e.issue.key))},LinkedIssues_Summary=e=>h.createElement("p",{style:{display:"inline"}},e.issue.summary),LinkedIssues_Priority=e=>e.issue.priority&&e.issue.priority.name&&e.issue.priority.iconUrl?h.createElement("div",{style:{width:"16px",height:"16px"}},h.createElement(l.A,{content:e.issue.priority.name},h.createElement("img",{src:e.issue.priority.iconUrl}))):h.createElement(h.Fragment,null),LinkedIssues_StatusColumn=e=>{if(e.issue.status&&e.issue.status.statusCategory){const t=Ee.zK[e.issue.status.statusCategory.colorName];return h.createElement(w.A,{appearance:t},e.issue.status.name)}return h.createElement(h.Fragment,null)},LinkedIssues=({issuelinks:e,onIssueClick:t,onDelete:s})=>h.createElement(T.A,{columns:[LinkedIssues_IssueKey,LinkedIssues_Summary,LinkedIssues_Priority,LinkedIssues_StatusColumn],columnWidths:["150px","100%","20px","150px"],items:e.map((e=>({id:e.id,content:{linkDescription:e.inwardIssue?e.type.inward:e.type.outward,issue:e.inwardIssue||e.outwardIssue,onIssueClick:t,onDelete:s}})))}),LinkedIssuesComponent=({linkTypes:e,label:t,onSave:s,loading:a,onFetchIssues:n,issuelinks:i,onIssueClick:l,onDelete:r,enableLinkedIssues:d})=>{const[m,u]=h.useState(!1),[p,g]=h.useState(void 0),[E,v]=h.useState(e.length>0?e[0]:void 0),{enable:y,setEnableLinkedIssues:k}=d;h.useEffect((()=>{y&&u(!0)}),[y]);return h.createElement(c.A,null,h.createElement(c.A,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},h.createElement("div",{style:{display:"flex",gap:"8px",flexDirection:"row",alignItems:"flex-start"}},h.createElement("label",{className:"ac-field-label"},t),a?h.createElement("p",null,"Saving..."):null),h.createElement(x.A,{appearance:"subtle",className:"ac-button-secondary-new",iconBefore:h.createElement(O.A,{size:"small",label:"Add"}),onClick:()=>u(!0)})),m&&h.createElement(c.A,{style:{display:"flex",flexDirection:"column",gap:"8px"}},h.createElement(c.A,{style:{display:"flex",flexDirection:"row",gap:"8px",width:"100%"}},h.createElement("div",{style:{width:"30%"}},h.createElement(he.A,{className:"ac-select-container",classNamePrefix:"ac-select",options:e,defaultValue:E,components:fe.th(o.eV.IssueLinks),getOptionLabel:fe.nM(o.eV.IssueLinks),getOptionValue:fe.SY(o.eV.IssueLinks),isDisabled:a,onChange:e=>{v(e)}})),h.createElement("div",{style:{width:"100%"}},h.createElement(ke.A,{className:"ac-select-container",classNamePrefix:"ac-select",loadOptions:n,getOptionLabel:e=>e.key,getOptionValue:e=>e.key,placeholder:"Search for an issue",onChange:e=>{p&&e.key===p.key||g(e)},components:{Option:fe.BQ,SingleValue:fe.HP}}))),h.createElement(c.A,{style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},h.createElement(ge.Ls,{appearance:"primary",disabled:void 0===p||a,onClick:()=>{p&&E&&(g(void 0),v(e.length>0?e[0]:void 0),u(!1),s({type:E,issueKey:p.key}))}},"Create"),h.createElement(ge.Ls,{appearance:"secondary",onClick:()=>{g(void 0),v(e.length>0?e[0]:void 0),u(!1),k(!1)}},"Cancel"))),h.createElement(LinkedIssues,{onIssueClick:l,issuelinks:i,onDelete:r}))},mainpanel_IssueMainPanel=({fields:e,fieldValues:t,handleAddAttachments:s,siteDetails:a,onDeleteAttachment:n,loadingField:i,isEpic:r,handleInlineEdit:o,subtaskTypes:c,linkTypes:d,handleOpenIssue:m,onDelete:u,onFetchIssues:p,fetchUsers:g,fetchImage:E,isRteEnabled:v=!1})=>{var y;const k=e.attachment&&t.attachment?t.attachment:void 0,f=e.subtasks&&t.subtasks&&!r&&!t.issuetype.subtask?t.subtasks:void 0,b=t.timetracking?t.timetracking.originalEstimate:"",A=e.issuelinks&&t.issuelinks?t.issuelinks:void 0,C=t.description?t.description:"",S=t["description.rendered"]?t["description.rendered"]:void 0,[w,I]=h.useState(!1),[D,N]=h.useState(!1),[L,V]=h.useState(!1),[F,M]=h.useState(!1),[W,B]=h.useState(C),[j,z]=h.useState(!1),T=h.createElement(l.A,{content:"Add content"},h.createElement(AddContentDropdown,{handleAttachmentClick:()=>V(!0),handleChildIssueClick:()=>{I(!0)},handleLinkedIssueClick:()=>{N(!0)},handleLogWorkClick:()=>{M(!0)},loading:"attachment"===i}));return h.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px"}},e.attachment&&h.createElement(AttachmentsModal,{isOpen:L,onSave:e=>{s(e),V(!1)},onCancel:()=>V(!1)}),h.createElement("div",{style:{display:"flex",flexDirection:"row",gap:"8px",alignItems:"center",paddingTop:"8px"}},e.worklog?h.createElement("div",{style:{display:"flex",flexDirection:"row",gap:"8px",alignItems:"center"}},h.createElement("div",{className:"ac-inline-dialog "+(F?"active":"")},h.createElement(R.A,{content:h.createElement(WorklogForm,{onSave:t=>o(e.worklog,t),onCancel:()=>M(!1),originalEstimate:b}),isOpen:F,onClose:()=>M(!1),placement:"top"},T))):{addContentDropDown:T}),e.description&&h.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},h.createElement("div",{style:{display:"flex",gap:"8px",flexDirection:"row",alignItems:"flex-start"}},h.createElement("label",{className:"ac-field-label"},"Description"),"description"===i?h.createElement("p",null,"Saving..."):null),j||"description"===i?h.createElement(P.A,{value:W,onChange:e=>{B(e)},onSave:t=>{o(e.description,t),z(!1)},onCancel:()=>{B(C),z(!1)},fetchUsers:g,isDescription:!0,saving:"description"===i,featureGateEnabled:v}):h.createElement("div",{css:{":hover":{backgroundColor:"var(--vscode-editor-selectionHighlightBackground)!important",cursor:"pointer !important"},paddingLeft:0,paddingBottom:"4px",display:"flex",alignItems:"flex-start"},onClick:()=>z(!0),className:"ac-inline-input-view-p"},S?h.createElement(U.t,{html:S,fetchImage:E}):h.createElement("p",{style:{margin:0}},W))),k&&k.length>0&&h.createElement("div",null,h.createElement("label",{className:"ac-field-label"},"Attachments"),h.createElement(AttachmentList,{attachments:k,baseLinkUrl:a.baseLinkUrl,onDelete:n,fetchImage:E})),f&&(f.length>0||w)&&h.createElement("div",null,h.createElement(ChildIssuesComponent,{subtaskTypes:c,label:"Child issues",loading:"subtasks"===i,onSave:t=>o(e.subtasks,t),enableSubtasks:{enable:w,setEnableSubtasks:I},handleOpenIssue:m,issues:f})),A&&(A.length>0||D)&&h.createElement("div",null,h.createElement(LinkedIssuesComponent,{linkTypes:d,onIssueClick:m,onSave:t=>o(e.issuelinks,t),label:"Linked issues",loading:"issuelinks"===i,issuelinks:A,onFetchIssues:p,onDelete:u,enableLinkedIssues:{enable:D,setEnableLinkedIssues:N}})),e.worklog&&Array.isArray(null===(y=t.worklog)||void 0===y?void 0:y.worklogs)&&t.worklog.worklogs.length>0&&h.createElement("div",{className:"ac-vpadding"},h.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},h.createElement("label",{className:"ac-field-label"},"Work log"),h.createElement(x.A,{className:"ac-button-secondary",appearance:"subtle",iconBefore:h.createElement(O.A,{size:"small",label:"Add"}),onClick:()=>M(!0)})),h.createElement(Worklogs,{worklogs:t.worklog})))};var be=s(68940),Ae=s(95995),Ce=s(49560),Se=s(68972),xe=s(73477),we=s(44633),Ie=s(82587);const De={isLoading:!1};class VotesForm extends h.Component{constructor(e){super(e),this.toggleVote=()=>{this.props.votes.hasVoted?(this.props.onRemoveVote(this.props.currentUser),this.setState({...De}),this.props.onClose()):this.handleAddVote(this.props.currentUser)},this.handleAddVote=e=>{this.props.onAddVote(e),this.setState({...De}),this.props.onClose()},this.getEmptyVoters=()=>{const e=[h.createElement(I.A,{size:"large"}),h.createElement(I.A,{size:"large"}),h.createElement(I.A,{size:"large"}),h.createElement(I.A,{size:"large"})];return h.createElement("div",null,h.createElement(Ie.A,{appearance:"stack",data:e,size:"large"}),h.createElement("span",null,"No voters yet"))},this.getStartStop=()=>this.props.votes.hasVoted?h.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleVote},h.createElement(Ce.A,{label:"starfilledicon",size:"medium"}),h.createElement("span",{style:{marginLeft:"8px"}},"Remove vote")):h.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleVote},h.createElement(Ae.A,{label:"staricon",size:"medium"}),h.createElement("span",{style:{marginLeft:"8px"}},"Vote for this issue")),this.getVoters=()=>{if(this.props.votes.votes<1)return this.getEmptyVoters();const e=this.props.votes.voters.map((e=>{const t=e.avatarUrls&&e.avatarUrls["48x48"]?e.avatarUrls["48x48"]:"";return h.createElement("div",{className:"ac-inline-watcher ac-inline-watcher-hover"},h.createElement(I.A,{size:"small",src:t}),h.createElement("div",{className:"ac-inline-watcher-name"},e.displayName))}));return h.createElement("div",null,h.createElement("div",{className:"ac-inline-watcher-list-heading"},"voted for this issue"),e)},this.state={...De}}render(){return h.createElement("div",{className:"ac-inline-items-container"},this.props.allowVoting&&h.createElement("div",{className:"ac-inline-item"},this.getStartStop()),h.createElement("div",{className:"ac-inline-item"},this.getVoters()))}}var Ne=s(20181),Le=s.n(Ne);const Ve={isLoading:!1};class WatchesForm extends h.Component{constructor(e){super(e),this.toggleWatching=()=>{this.props.watches.isWatching?(this.props.onRemoveWatcher(this.props.currentUser),this.setState({...Ve}),this.props.onClose()):this.handleAddWatcher(this.props.currentUser)},this.handleAddWatcher=e=>{this.props.onAddWatcher(e),this.setState({...Ve}),this.props.onClose()},this.getEmptyWatchers=()=>{const e=[h.createElement(I.A,{size:"large"}),h.createElement(I.A,{size:"large"}),h.createElement(I.A,{size:"large"}),h.createElement(I.A,{size:"large"})];return h.createElement("div",null,h.createElement(Ie.A,{appearance:"stack",data:e,size:"large"}),h.createElement("span",null,"No watchers yet"))},this.getStartStop=()=>this.props.watches.isWatching?h.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleWatching},h.createElement(xe.A,{label:"watchfilledicon",size:"medium"}),h.createElement("span",{style:{marginLeft:"8px"}},"Stop watching")):h.createElement("div",{className:"ac-icon-with-text ac-inline-watcher-hover",style:{cursor:"pointer"},onClick:this.toggleWatching},h.createElement(Se.A,{label:"watchicon",size:"medium"}),h.createElement("span",{style:{marginLeft:"8px"}},"Start watching")),this.getWatchers=()=>{if(this.props.watches.watchCount<1)return this.getEmptyWatchers();const e=this.props.watches.watchers.map((e=>{const t=e.avatarUrls&&e.avatarUrls["48x48"]?e.avatarUrls["48x48"]:"";return h.createElement("div",{className:"ac-inline-watcher ac-inline-watcher-hover"},h.createElement(I.A,{size:"small",src:t}),h.createElement("div",{className:"ac-inline-watcher-name"},e.displayName),h.createElement("div",{className:"ac-inline-watcher-delete",onClick:()=>this.props.onRemoveWatcher(e)}))}));return h.createElement("div",null,h.createElement("div",{className:"ac-inline-watcher-list-heading"},"watching this issue"),e)},this.state={...Ve}}render(){const e={isMulti:!1,className:"ac-select-container",classNamePrefix:"ac-select",getOptionLabel:fe.nM(o.eV.User),getOptionValue:fe.SY(o.eV.User),components:fe.th(o.eV.User),placeholder:"Add watchers"};return h.createElement("div",{className:"ac-inline-items-container"},h.createElement("div",{className:"ac-inline-item"},this.getStartStop()),h.createElement("div",{className:"ac-inline-item"},this.getWatchers()),h.createElement("div",{className:"ac-inline-item"},h.createElement(ke.A,{...e,isLoading:this.state.isLoading,onChange:Le()(this.handleAddWatcher,100),loadOptions:this.props.onFetchUsers})))}}var Fe=s(6785);const StatusTransitionMenu=e=>{const[t,s]=h.useState(!1),[a,n]=h.useState(!1),{border:i,background:l}=getDynamicStyles(e.currentStatus.statusCategory.colorName),r=e.transitions.some((e=>e.name!==e.to.name));return h.createElement(c.A,{style:{display:"flex"}},h.createElement(ie.A,{css:{backgroundColor:"var(--vscode-settings-textInputBackground)!important",":hover":{backgroundColor:"var(--vscode-editor-selectionHighlightBackground)!important"}},onOpenChange:e=>n(e.isOpen),isLoading:e.isStatusButtonLoading,trigger:({triggerRef:n,...r})=>h.createElement(ne.A,{isLoading:e.isStatusButtonLoading,onMouseOver:()=>s(!0),onMouseLeave:()=>s(!1),style:{alignContent:"center",border:a||t?"1px solid var(--vscode-list-focusOutline)":i,backgroundColor:l,color:"var(--vscode-editor-foreground)"},...r,ref:n,iconAfter:h.createElement(Fe.A,{label:"Status"})},e.currentStatus.name)},h.createElement(c.A,{style:{display:"flex",flexDirection:"column",backgroundColor:"var(--vscode-settings-textInputBackground)",paddingTop:"4px",paddingBottom:"4px",border:"1px solid var(--vscode-list-focusOutline)"}},e.transitions.map((t=>{return h.createElement(le.A,{key:t.id,css:{":hover":{background:"var(--vscode-editor-selectionHighlightBackground) !important"}},onClick:()=>e.onStatusChange(t)},r?(s=t,h.createElement(c.A,null,`${s.name} \u2192 `,h.createElement(w.A,{appearance:Ee.zK[s.to.statusCategory.colorName]},s.to.name))):(e=>h.createElement(c.A,null,h.createElement(w.A,{appearance:Ee.zK[e.to.statusCategory.colorName]},e.to.name)))(t));var s})))))},getDynamicStyles=e=>{let t={border:"",bg:""};return t=Me[e]?Me[e]:Me.default,{border:`1px solid ${t.border}`,background:t.bg}},Me={yellow:{border:"#669DF1",bg:"#669DF133"},green:{border:"#94C748",bg:"#94C74833"},"blue-gray":{border:"#B0BEC5",bg:"#B0BEC533"},default:{border:"#B0BEC5",bg:"#B0BEC533"}},IssueSidebarButtonGroup=({handleRefresh:e,handleAddWatcher:t,handleRemoveWatcher:s,handleAddVote:a,handleRemoveVote:n,handleInlineEdit:i,currentUser:r,fields:o,fieldValues:d,loadingField:m,fetchUsers:u,handleStatusChange:p,handleStartWork:g,transitions:E})=>{const v=d.timetracking?d.timetracking.originalEstimate:"",y=d.watches&&d.watches.watchCount>0?d.watches.watchCount:"",k=d.votes&&d.votes.votes>0?d.votes.votes:"",f=d.reporter&&r&&d.reporter.accountId!==r.accountId,[b,A]=h.useState(!1),[C,S]=h.useState(!1),[x,w]=h.useState(!1);return h.createElement(c.A,{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",justifyContent:"space-between"}},h.createElement(c.A,{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"4px"}},h.createElement(l.A,{content:"Create a branch and transition this issue"},h.createElement(ne.A,{className:"ac-button",onClick:g,iconBefore:h.createElement(we.A,{label:"Start work"}),isLoading:!1},"Start work")),o.status&&h.createElement(c.A,{style:{display:"inline-flex",alignItems:"center",flexGrow:0}},h.createElement(StatusTransitionMenu,{transitions:E,currentStatus:d.status,isStatusButtonLoading:"status"===m,onStatusChange:p}))),h.createElement(c.A,{style:{display:"flex",flexDirection:"row",alignContent:"center",gap:"4px",justifyContent:"flex-end",background:"var(--vscode-editor-background)"}},h.createElement(l.A,{content:"Refresh"},h.createElement(ne.A,{spacing:"none",className:"ac-button-secondary",onClick:e,iconBefore:h.createElement(be.A,{label:"refresh"}),isLoading:"refresh"===m})),o.worklog&&h.createElement("div",{className:"ac-inline-dialog "+(b?"active":"")},h.createElement(R.A,{content:h.createElement(WorklogForm,{onSave:e=>{i(o.worklog,e)},onCancel:()=>A(!1),originalEstimate:v}),isOpen:b,onClose:()=>A(!1),placement:"left-start"},h.createElement(l.A,{content:"Log work"},h.createElement(ne.A,{spacing:"none",className:"ac-button-secondary",onClick:()=>A(!0),iconBefore:h.createElement(ce.A,{label:"Log Work"}),isLoading:"worklog"===m})))),o.watches&&h.createElement("div",{className:"ac-inline-dialog "+(x?"active":"")},h.createElement(R.A,{content:h.createElement(WatchesForm,{onFetchUsers:async e=>await u(e),onAddWatcher:t,onRemoveWatcher:s,currentUser:r,onClose:()=>w(!1),watches:d.watches}),isOpen:x,onClose:()=>w(!1),placement:"left-start"},h.createElement(l.A,{content:"Watch options"},h.createElement(ne.A,{spacing:"none",className:"ac-button-secondary",onClick:()=>{w(!0)},iconBefore:d.watches.isWatching?h.createElement(xe.A,{label:"Watches"}):h.createElement(Se.A,{label:"Watches"}),isLoading:"watches"===m},y)))),o.votes&&h.createElement("div",{className:"ac-inline-dialog "+(C?"active":"")},h.createElement(R.A,{content:h.createElement(VotesForm,{onAddVote:a,onRemoveVote:n,currentUser:r,onClose:()=>S(!1),allowVoting:f,votes:d.votes}),isOpen:C,onClose:()=>S(!1),placement:"left-start"},h.createElement(l.A,{content:"Vote options"},h.createElement(ne.A,{spacing:"none",className:"ac-button-secondary",onClick:()=>S(!0),iconBefore:d.votes.hasVoted?h.createElement(Ce.A,{label:"Votes"}):h.createElement(Ae.A,{label:"Votes"}),isLoading:"votes"===m},k))))))};var Ue=s(18720);const CollapsibleButton=({label:e,isOpen:t,toggleOpen:s})=>{const a=t?"3px 3px 0 0":"3px",[n,i]=h.useState(!1),l=n?"1px solid var(--vscode-list-focusOutline)":"1px solid var(--vscode-editorGroup-border)";return h.createElement(x.A,{style:{display:"flex",width:"100%",background:"var(--vscode-editor-background)",alignItems:"center",color:"var(--vscode-editor-foreground)",border:l,padding:"12px",borderRadius:a,height:"36px"},onMouseOver:()=>i(!0),onMouseLeave:()=>i(!1),onClick:s,iconAfter:t?h.createElement(Fe.A,{label:"Collapse",size:"medium"}):h.createElement(Ue.A,{label:"Expand",size:"medium"})},h.createElement(c.A,{className:"ac-field-label",style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",width:"100%"}},e))},IssueSidebarCollapsible=({label:e,items:t,defaultOpen:s=!1})=>{const[a,n]=h.useState(s);return h.createElement(c.A,{style:{display:"flex",flexDirection:"column",width:"100%"}},h.createElement(CollapsibleButton,{label:e,isOpen:a,toggleOpen:()=>{n(!a)}}),a&&h.createElement(c.A,{style:{display:"flex",flexDirection:"column",gap:"8px",padding:"12px",border:"1px solid var(--vscode-editorGroup-border)",borderTop:0,borderRadius:"0 0 3px 3px"}},t.map(((e,t)=>h.createElement(c.A,{key:t,style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px",width:"100%"}},h.createElement("div",{style:{width:"30%",textAlign:"left",color:"var(--vscode-panelTitle-inactiveForeground"}},e.itemLabel),h.createElement(c.A,{style:{width:"70%"}},e.itemComponent))))))},Pe={...C.b,...g.t,showMore:!1,currentInlineDialog:""};class JiraIssuePage extends C.i{constructor(e){super(e),this.advancedSidebarFields=[],this.advancedMainFields=[],this.attachingInProgress=!1,this.getProjectKey=()=>this.state.key.substring(0,this.state.key.indexOf("-")),this.handleCopyIssueLink=()=>{this.postMessage({action:"copyJiraIssueLink"})},this.handleStartWorkOnIssue=()=>{this.postMessage({action:"openStartWorkPage",issue:{key:this.state.key,siteDetails:this.state.siteDetails}})},this.buildPrompt=(e,t)=>`\n            Let's work on this issue:\n\n            Summary:\n            ${e}\n            `+(t?`\n            Description:\n            ${t}\n            `:"")+"\n            Please provide a detailed plan to resolve this issue, including any necessary steps, code snippets, or references to documentation.\n            Make sure to consider the context of the issue and provide a comprehensive solution.\n            Feel free to ask for any additional information if needed.\n        ",this.handleInvokeRovodev=()=>{const e=this.state.fieldValues.summary||"",t=this.state.fieldValues.description||"",s=this.buildPrompt(e,t);this.postMessage({action:"invokeRovodev",prompt:s,issueKey:this.state.key,siteDetails:this.state.siteDetails})},this.fetchUsers=e=>this.loadSelectOptions(e,`${this.state.siteDetails.baseApiUrl}/api/${this.state.apiVersion}/user/search?${this.state.siteDetails.isCloud?"query":"username"}=`),this.handleInlineEdit=async(e,t)=>{switch(e.uiType){case o.HC.Subtasks:{this.setState({isSomethingLoading:!0,loadingField:e.key});const s=t;s.project={key:this.getProjectKey()},s.parent={key:this.state.key},this.postMessage({action:"createIssue",site:this.state.siteDetails,issueData:{fields:s}});break}case o.HC.IssueLinks:this.setState({isSomethingLoading:!0,loadingField:"issuelinks"}),this.postMessage({action:"createIssueLink",site:this.state.siteDetails,issueLinkData:{type:{id:t.type.id},inwardIssue:"inward"===t.type.type?{key:t.issueKey}:{key:this.state.key},outwardIssue:"outward"===t.type.type?{key:t.issueKey}:{key:this.state.key}},issueLinkType:t.type});break;case o.HC.Timetracking:{let s=this.state.fieldValues[e.key];s?s.originalEstimate=t:s={originalEstimate:t},this.setState({loadingField:e.key,isSomethingLoading:!0,fieldValues:{...this.state.fieldValues,[e.key]:s}}),await this.handleEditIssue(`${e.key}`,{originalEstimate:t});break}case o.HC.Worklog:this.setState({isSomethingLoading:!0,loadingField:e.key}),this.postMessage({action:"createWorklog",site:this.state.siteDetails,worklogData:t,issueKey:this.state.key});break;default:{let s=t;s&&e.valueType===o.eV.Number&&"number"!==typeof t&&(s=parseFloat(t)),this.setState({loadingField:e.key,fieldValues:{...this.state.fieldValues,[e.key]:s}}),void 0===s&&(s=null),await this.handleEditIssue(e.key,s);break}}},this.handleEditIssue=async(e,t)=>{this.setState({isSomethingLoading:!0,loadingField:e});const s=(0,u.A)();await this.postMessageWithEventPromise({action:"editIssue",fields:{[e]:t},nonce:s},"editIssueDone",y.QJ,s)},this.handleCreateComment=(e,t)=>{this.setState({isSomethingLoading:!0,loadingField:"comment"});const s={action:"comment",issue:{key:this.state.key,siteDetails:this.state.siteDetails},commentBody:e,restriction:t};this.postMessage(s)},this.handleUpdateComment=(e,t,s)=>{const a={action:"comment",issue:{key:this.state.key,siteDetails:this.state.siteDetails},commentBody:e,commentId:t,restriction:s};this.postMessage(a)},this.handleDeleteComment=e=>{this.postMessage({action:"deleteComment",issue:{key:this.state.key,siteDetails:this.state.siteDetails},commentId:e})},this.handleStatusChange=e=>{this.setState({isSomethingLoading:!0,loadingField:"status"}),this.postMessage({action:"transitionIssue",transition:e,issue:{key:this.state.key,siteDetails:this.state.siteDetails}})},this.handleOpenWorklogEditor=()=>{"worklog"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"worklog",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleOpenWatchesEditor=()=>{"watches"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"watches",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleOpenVotesEditor=()=>{"votes"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"votes",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleOpenAttachmentEditor=()=>{"attachment"!==this.state.currentInlineDialog?this.setState({currentInlineDialog:"attachment",isSomethingLoading:!0}):this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleInlineDialogClose=()=>{this.setState({currentInlineDialog:"",isSomethingLoading:!1})},this.handleInlineDialogSave=(e,t)=>{this.setState({currentInlineDialog:"",isSomethingLoading:!1}),this.handleInlineEdit(e,t)},this.handleAddWatcher=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"watches"}),this.postMessage({action:"addWatcher",site:this.state.siteDetails,issueKey:this.state.key,watcher:e})},this.handleRemoveWatcher=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"watches"}),this.postMessage({action:"removeWatcher",site:this.state.siteDetails,issueKey:this.state.key,watcher:e})},this.handleAddVote=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"votes"}),this.postMessage({action:"addVote",site:this.state.siteDetails,issueKey:this.state.key,voter:e})},this.handleRemoveVote=e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!0,loadingField:"votes"}),this.postMessage({action:"removeVote",site:this.state.siteDetails,issueKey:this.state.key,voter:e})},this.handleAddAttachments=e=>{this.attachingInProgress||(this.attachingInProgress=!0,(0,v.f)(e).then((e=>{this.setState({currentInlineDialog:"",isSomethingLoading:!1,loadingField:"attachment"});const t=e.map((e=>({lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,path:e.path,fileContent:e.fileContent})));this.postMessage({action:"addAttachments",site:this.state.siteDetails,issueKey:this.state.key,files:t})})).finally((()=>this.attachingInProgress=!1)))},this.handleDeleteAttachment=e=>{this.setState({isSomethingLoading:!0,loadingField:"attachment"}),this.postMessage({action:"deleteAttachment",site:this.state.siteDetails,objectWithId:e})},this.handleRefresh=()=>{this.setState({isSomethingLoading:!0,loadingField:"refresh"}),this.postMessage({action:"refreshIssue"})},this.handleDeleteIssuelink=e=>{this.setState({isSomethingLoading:!0,loadingField:"issuelinks"}),this.postMessage({action:"deleteIssuelink",site:this.state.siteDetails,objectWithId:e})},this.state=Pe}getInputMarkup(e,t,s){return e?super.getInputMarkup(e,t):(console.warn(`Field error - no field when trying to render ${s}`),null)}onMessageReceived(e){const t=super.onMessageReceived(e);if(!t)switch(e.type){case"update":{const t=e;this.updateInternals(t),this.setState({...t,isErrorBannerOpen:!1,errorDetails:void 0,isSomethingLoading:!1,loadingField:""});break}case"epicChildrenUpdate":this.setState({isSomethingLoading:!1,loadingField:"",epicChildren:e.epicChildren});break;case"pullRequestUpdate":this.setState({recentPullRequests:e.recentPullRequests});break;case"currentUserUpdate":this.setState({currentUser:e.currentUser});break;case"issueCreated":(0,g.QX)(e)&&this.setState({isSomethingLoading:!1,loadingField:""})}return t}updateInternals(e){const t=this.sortFieldValues(e.fields);this.advancedMainFields=[],this.advancedSidebarFields=[],t.forEach((e=>{e.advanced&&(e.uiType===o.HC.Input&&e.isMultiline?this.advancedMainFields.push(e):this.advancedSidebarFields.push(e))}))}getMainPanelNavMarkup(){const e=this.state.fieldValues[this.state.epicFieldInfo.epicLink.id];let t="";e&&("object"===typeof e&&e.value?t=e.value:"string"===typeof e&&(t=e));const s=this.state.fieldValues.parent&&this.state.fieldValues.parent.issuetype?this.state.fieldValues.parent.issuetype.iconUrl:void 0,a=this.state.fieldValues.issuetype?this.state.fieldValues.issuetype.iconUrl:void 0;return h.createElement("div",null,this.state.showPMF&&h.createElement(A.A,{onPMFOpen:()=>this.onPMFOpen(),onPMFVisiblity:e=>this.setState({showPMF:e}),onPMFLater:()=>this.onPMFLater(),onPMFNever:()=>this.onPMFNever(),onPMFSubmit:e=>this.onPMFSubmit(e)}),h.createElement("div",{className:"ac-page-header"},h.createElement("div",{className:"ac-breadcrumbs"},e&&""!==t&&h.createElement(h.Fragment,null,h.createElement(S.A,{text:t,onItemClick:()=>this.handleOpenIssue({siteDetails:this.state.siteDetails,key:t})}),h.createElement("span",{className:"ac-breadcrumb-divider"},"/")),this.state.fieldValues.parent&&h.createElement(h.Fragment,null,h.createElement(S.A,{text:this.state.fieldValues.parent.key,iconUrl:s,onItemClick:()=>this.handleOpenIssue({siteDetails:this.state.siteDetails,key:this.state.fieldValues.parent.key})}),h.createElement("span",{className:"ac-breadcrumb-divider"},"/")),h.createElement(l.A,{content:`Created on ${this.state.fieldValues["created.rendered"]||this.state.fieldValues.created}`},h.createElement(S.A,{text:`${this.state.key}`,href:`${this.state.siteDetails.baseLinkUrl}/browse/${this.state.key}`,iconUrl:a,onCopy:this.handleCopyIssueLink})))),this.state.isErrorBannerOpen&&h.createElement(f.A,{onDismissError:this.handleDismissError,errorDetails:this.state.errorDetails}))}getMainPanelBodyMarkup(){return h.createElement("div",{style:{display:"flex",flexDirection:"column",paddingTop:"4px"}},h.createElement(mainpanel_IssueMainPanel,{fields:this.state.fields,fieldValues:this.state.fieldValues,handleAddAttachments:this.handleAddAttachments,siteDetails:this.state.siteDetails,onDeleteAttachment:this.handleDeleteAttachment,loadingField:this.state.loadingField,subtaskTypes:this.state.selectFieldOptions.subtasks,linkTypes:this.state.selectFieldOptions.issuelinks,isEpic:this.state.isEpic,handleInlineEdit:this.handleInlineEdit,handleOpenIssue:this.handleOpenIssue,onFetchIssues:async e=>await this.loadIssueOptions(this.state.fields.issuelinks,e),onDelete:this.handleDeleteIssuelink,fetchUsers:async e=>(await this.fetchUsers(e)).map((e=>{var t;return{displayName:e.displayName,avatarUrl:null===(t=e.avatarUrls)||void 0===t?void 0:t["48x48"],mention:this.state.siteDetails.isCloud?`[~accountid:${e.accountId}]`:`[~${e.name}]`}})),fetchImage:e=>this.fetchImage(e),isRteEnabled:this.state.isRteEnabled}),this.advancedMain(),this.state.fields.comment&&h.createElement("div",{className:"ac-vpadding"},h.createElement("label",{className:"ac-field-label"},"Comments"),h.createElement(IssueCommentComponent,{comments:this.state.fieldValues.comment.comments,currentUser:this.state.currentUser,siteDetails:this.state.siteDetails,onCreate:this.handleCreateComment,onSave:this.handleUpdateComment,fetchUsers:async e=>(await this.fetchUsers(e)).map((e=>{var t;return{displayName:e.displayName,avatarUrl:null===(t=e.avatarUrls)||void 0===t?void 0:t["48x48"],mention:this.state.siteDetails.isCloud?`[~accountid:${e.accountId}]`:`[~${e.name}]`}})),fetchImage:e=>this.fetchImage(e),onDelete:this.handleDeleteComment,isServiceDeskProject:this.state.fieldValues.project&&"service_desk"===this.state.fieldValues.project.projectTypeKey,isRteEnabled:this.state.isRteEnabled})))}commonSidebar(){const e=["assignee","reporter","labels","priority","components","fixVersions"].filter((e=>!!this.state.fields[e])).map((e=>({itemLabel:this.state.fields[e].name,itemComponent:this.getInputMarkup(this.state.fields[e],!0,e)}))),t=this.advancedSidebarFields.map((e=>e.advanced&&e.uiType!==o.HC.NonEditable?(e.uiType===o.HC.Timetracking&&(e.name="Original estimate"),{itemLabel:e.name,itemComponent:this.getInputMarkup(e,!0,"Advanced sidebar")}):void 0)).filter((e=>void 0!==e));return this.state.recentPullRequests&&this.state.recentPullRequests.length>0&&t.push({itemLabel:"Recent pull requests",itemComponent:h.createElement(PullRequests,{pullRequests:this.state.recentPullRequests,onClick:e=>this.postMessage({action:"openPullRequest",prHref:e.url})})}),h.createElement(c.A,{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px"}},h.createElement(IssueSidebarButtonGroup,{handleAddVote:this.handleAddVote,handleAddWatcher:this.handleAddWatcher,handleInlineEdit:this.handleInlineEdit,handleRefresh:this.handleRefresh,handleRemoveVote:this.handleRemoveVote,handleRemoveWatcher:this.handleRemoveWatcher,currentUser:this.state.currentUser,fields:this.state.fields,fieldValues:this.state.fieldValues,loadingField:this.state.loadingField,fetchUsers:this.fetchUsers,transitions:this.state.selectFieldOptions.transitions,handleStatusChange:this.handleStatusChange,handleStartWork:this.handleStartWorkOnIssue}),!1,h.createElement(IssueSidebarCollapsible,{label:"Details",items:e,defaultOpen:!0}),h.createElement(IssueSidebarCollapsible,{label:"More fields",items:t}))}advancedMain(){const e=[];return this.advancedMainFields.forEach((t=>{t.advanced&&t.uiType!==o.HC.NonEditable&&e.push(h.createElement("div",{className:"ac-vpadding"},h.createElement("label",{className:"ac-field-label"},t.name),this.getInputMarkup(t,!0,"Advanced main")))})),e}createdUpdatedDates(){let e,t;try{e=`Created ${(0,d.m)((0,m.H)(this.state.fieldValues.created))} ago`,t=`Updated ${(0,d.m)((0,m.H)(this.state.fieldValues.updated))} ago`}catch(s){e=this.state.fieldValues["created.rendered"]||this.state.fieldValues.created,t=this.state.fieldValues["updated.rendered"]||this.state.fieldValues.updated}return h.createElement("div",{className:"ac-issue-created-updated"},e&&h.createElement("div",null,e),"\u2022",t&&h.createElement("div",null,t))}render(){return(Object.keys(this.state.fields).length<1||Object.keys(this.state.fieldValues).length<1)&&!this.state.isErrorBannerOpen&&this.state.isOnline?(this.postMessage({action:"refreshIssue"}),h.createElement(k.V,null)):this.state.isOnline?h.createElement(a.Ay,null,h.createElement(E.H,{context:{view:p.id.JiraIssuePage},postMessageFunc:e=>{this.postMessage(e)}},h.createElement(r.A,null,(e=>e&&e<800?h.createElement("div",{style:{margin:"20px 16px 0px 16px"}},this.getMainPanelNavMarkup(),h.createElement("h1",null,this.getInputMarkup(this.state.fields.summary,!0,"summary")),this.commonSidebar(),this.getMainPanelBodyMarkup(),this.createdUpdatedDates()):h.createElement("div",{style:{maxWidth:"1200px",margin:"20px auto 0 auto"}},h.createElement(n.A,{layout:"fluid"},h.createElement(i.A,null,this.getMainPanelNavMarkup(),h.createElement("div",{style:{paddingTop:"8px"}},h.createElement(n.A,{layout:"fluid"},h.createElement(i.A,{medium:8},h.createElement("h1",null,this.getInputMarkup(this.state.fields.summary,!0,"summary")),this.getMainPanelBodyMarkup()),h.createElement(i.A,{medium:4},this.commonSidebar(),this.createdUpdatedDates())))))))))):h.createElement(b.A,null)}}}}]);